<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Encriptador de Texto - Nixuslab</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Encripta y desencripta tus textos de forma segura.">
    <!-- Google Fonts y Font Awesome (heredado de la plantilla) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" xintegrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Hoja de estilos global para header, footer, etc. -->
    <link rel="stylesheet" href="styles.css">

    <!-- Estilos específicos para la aplicación de encriptación -->
    <style>
        :root {
            --encrypt-bg: #1a1a1a;
            --encrypt-panel: #222222;
            --encrypt-border: #333333;
            --encrypt-button-bg: var(--primary-color);
            --encrypt-button-text: #000;
            --encrypt-button-hover: var(--primary-color-darker);
        }

        .encrypt-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            width: 100%;
            max-width: 800px; /* Ancho del contenedor principal */
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--encrypt-bg);
            border-radius: 12px;
            border: 1px solid var(--encrypt-border);
        }

        .encrypt-container h1 {
            font-family: var(--font-heading);
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .encrypt-panel {
            width: 100%;
            padding: 1.5rem;
            background-color: var(--encrypt-panel);
            border-radius: 8px;
            border: 1px solid var(--encrypt-border);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .encrypt-panel label {
            font-family: var(--font-heading);
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: -0.5rem;
        }

        .encrypt-panel textarea,
        .encrypt-panel input[type="password"] {
            width: 100%;
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--encrypt-border);
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: var(--font-body);
            font-size: 1rem;
            resize: vertical;
            min-height: 120px;
        }
        
        .encrypt-panel input[type="password"] {
            min-height: auto;
        }

        .encrypt-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .encrypt-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            background-color: var(--encrypt-button-bg);
            color: var(--encrypt-button-text);
            font-family: var(--font-heading);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .encrypt-btn:hover {
            background-color: var(--encrypt-button-hover);
            transform: translateY(-2px);
        }
        
        .copy-btn {
            background-color: #444;
            color: var(--text-color);
        }
        .copy-btn:hover {
             background-color: #555;
        }

        #notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: var(--encrypt-button-text);
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }
        #notification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-20px);
        }

    </style>
</head>
<body>

    <!-- El header se cargará dinámicamente aquí -->
    <div id="header-placeholder"></div>

    <main>
        <div class="encrypt-container">
            <h1>Encriptador de Texto</h1>

            <div class="encrypt-panel">
                <label for="password">Contraseña Secreta</label>
                <input type="password" id="password" placeholder="Escribe tu contraseña para encriptar/desencriptar">
            </div>

            <div class="encrypt-panel">
                <label for="inputText">Texto Original o Encriptado</label>
                <textarea id="inputText" rows="6" placeholder="Pega aquí el texto que quieres procesar..."></textarea>
            </div>

            <div class="encrypt-actions">
                <button id="encryptBtn" class="encrypt-btn">Encriptar</button>
                <button id="decryptBtn" class="encrypt-btn">Desencriptar</button>
            </div>

            <div class="encrypt-panel">
                <label for="outputText">Resultado</label>
                <textarea id="outputText" rows="6" readonly placeholder="Aquí aparecerá el resultado..."></textarea>
                <button id="copyBtn" class="encrypt-btn copy-btn">Copiar Resultado</button>
            </div>
        </div>
    </main>
    
    <div id="notification"></div>

    <!-- El footer se cargará dinámicamente aquí -->
    <div id="footer-placeholder"></div>

    <!-- Scripts de carga del Header/Footer -->
    <script>
        // Función para cargar el header
        async function loadHeader() {
            try {
                const response = await fetch('header.html');
                const html = await response.text();
                document.getElementById('header-placeholder').innerHTML = html;
                
                const menuToggle = document.querySelector('.menu-toggle');
                const nav = document.querySelector('nav ul');
                
                if (menuToggle && nav) {
                    menuToggle.addEventListener('click', () => {
                        nav.classList.toggle('active');
                    });
                }
            } catch (error) {
                console.error('Error al cargar el header:', error);
            }
        }

        // Función para cargar el footer
        async function loadFooter() {
            try {
                const response = await fetch('footer.html');
                const html = await response.text();
                document.getElementById('footer-placeholder').innerHTML = html;
            } catch (error) {
                console.error('Error al cargar el footer:', error);
            }
        }

        // Cargar header y footer cuando el documento esté listo
        document.addEventListener('DOMContentLoaded', () => {
            loadHeader();
            loadFooter();
        });
    </script>

    <!-- Lógica de la aplicación de encriptación -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const passwordInput = document.getElementById('password');
            const inputText = document.getElementById('inputText');
            const outputText = document.getElementById('outputText');
            const encryptBtn = document.getElementById('encryptBtn');
            const decryptBtn = document.getElementById('decryptBtn');
            const copyBtn = document.getElementById('copyBtn');
            const notification = document.getElementById('notification');

            function showNotification(message) {
                notification.textContent = message;
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }

            async function getKey(password) {
                const encoder = new TextEncoder();
                const keyMaterial = await window.crypto.subtle.importKey(
                    'raw',
                    encoder.encode(password),
                    { name: 'PBKDF2' },
                    false,
                    ['deriveKey']
                );
                return window.crypto.subtle.deriveKey(
                    {
                        "name": 'PBKDF2',
                        "salt": encoder.encode('a-unique-salt'), // ¡En una app real, este salt debería ser único y guardarse!
                        "iterations": 100000,
                        "hash": 'SHA-256'
                    },
                    keyMaterial,
                    { "name": 'AES-GCM', "length": 256 },
                    true,
                    [ "encrypt", "decrypt" ]
                );
            }

            encryptBtn.addEventListener('click', async () => {
                const password = passwordInput.value;
                const text = inputText.value;
                if (!password || !text) {
                    showNotification('Por favor, introduce texto y contraseña.');
                    return;
                }
                try {
                    const key = await getKey(password);
                    const iv = window.crypto.getRandomValues(new Uint8Array(12));
                    const encrypted = await window.crypto.subtle.encrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        new TextEncoder().encode(text)
                    );
                    
                    const ivB64 = btoa(String.fromCharCode.apply(null, iv));
                    const encryptedB64 = btoa(String.fromCharCode.apply(null, new Uint8Array(encrypted)));
                    
                    outputText.value = ivB64 + ':' + encryptedB64;
                    showNotification('¡Texto encriptado!');
                } catch (e) {
                    showNotification('Error al encriptar.');
                    console.error(e);
                }
            });

            decryptBtn.addEventListener('click', async () => {
                const password = passwordInput.value;
                const encryptedText = inputText.value;
                 if (!password || !encryptedText) {
                    showNotification('Por favor, introduce texto encriptado y contraseña.');
                    return;
                }
                try {
                    const [ivB64, encryptedB64] = encryptedText.split(':');
                    if (!ivB64 || !encryptedB64) {
                        throw new Error("Formato de texto encriptado inválido.");
                    }
                    
                    const iv = new Uint8Array(atob(ivB64).split('').map(c => c.charCodeAt(0)));
                    const encryptedData = new Uint8Array(atob(encryptedB64).split('').map(c => c.charCodeAt(0)));

                    const key = await getKey(password);
                    const decrypted = await window.crypto.subtle.decrypt(
                        { name: 'AES-GCM', iv: iv },
                        key,
                        encryptedData
                    );
                    outputText.value = new TextDecoder().decode(decrypted);
                    showNotification('¡Texto desencriptado!');
                } catch (e) {
                    showNotification('Error al desencriptar. Revisa la contraseña o el texto.');
                    console.error(e);
                }
            });

            copyBtn.addEventListener('click', () => {
                if (!outputText.value) {
                    showNotification('No hay nada que copiar.');
                    return;
                }
                // Usamos el método execCommand para compatibilidad en iframes
                outputText.select();
                document.execCommand('copy');
                showNotification('¡Resultado copiado!');
            });
        });
    </script>

</body>
</html>
